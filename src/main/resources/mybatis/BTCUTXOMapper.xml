<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cdkj.coin.dao.IBTCUtxoDAO">

    <resultMap id="BaseResultMap" type="com.cdkj.coin.domain.BTC.BTCUTXO">
        <id column="id" property="id"/>
        <result column="txid" jdbcType="CHAR" property="txid"/>
        <result column="vout" jdbcType="INTEGER" property="vout"/>
        <result column="count" jdbcType="DECIMAL" property="count"/>
        <result column="address" jdbcType="CHAR" property="address"/>
        <result column="sync_time" jdbcType="TIMESTAMP" property="syncTime"/>
        <result column="block_height" jdbcType="INTEGER" property="blockHeight"/>
        <result column="status" jdbcType="VARCHAR" property="status"/>
    </resultMap>

    <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.cdkj.coin.domain.BTC.BTCUTXO">
        <result column="script_pub_key" jdbcType="LONGVARCHAR" property="scriptPubKey"/>
    </resultMap>

    <sql id="Base_Column_List">
        txid, vout, count, address, sync_time, block_height, status
    </sql>

    <sql id="Blob_Column_List">
        script_pub_key
    </sql>

    <insert id="insertBatch" parameterType="List">

        insert into `btc_default_utxo`(`txid`, `vout`, `count`,
        `address`, `sync_time`, block_height,
        `status`, script_pub_key
        )
        VALUES
        <foreach collection="list" item="utxo" separator=",">
            ( #{utxo.txid}, #{utxo.vout}, #{utxo.count},
            #{utxo.address}, #{utxo.syncTime}, #{utxo.blockHeight},
            #{utxo.status}, #{utxo.scriptPubKey})
        </foreach>
    </insert>

    <select id="selectUnPushUTXO" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from tctq_btc_utxo where `status` = '0' or `status` = '2' limit 0,50;
    </select>

    <select id="selectByTxidAndVout">
        SELECT
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        FROM tctq_btc_utxo where `txid` = #{txid} and `vout` = #{vout}
    </select>



    <update id="updateByPrimaryKeySelective" parameterType="com.cdkj.coin.domain.BTC.BTCUTXO">
        update tctq_btc_utxo
        <set>
            <if test="count != null and count != '' ">
                count = #{count,jdbcType=DECIMAL},
            </if>
            <if test="address != null and address != '' ">
                address = #{address,jdbcType=CHAR},
            </if>
            <if test="syncTime != null and blockHeight != ''">
                sync_time = #{syncTime,jdbcType=TIMESTAMP},
            </if>
            <if test="blockHeight != null and blockHeight != '' ">
                block_height = #{blockHeight,jdbcType=INTEGER},
            </if>
            <if test="status != null and status != '' ">
                `status` = #{status,jdbcType=VARCHAR},
            </if>
            <if test="spendTxid != null and spendTxid != '' ">
                spend_txid = #{spendTxid,jdbcType=CHAR},
            </if>
            <if test="collectionTime != null and collectionTime != '' ">
                collection_time = #{collectionTime,jdbcType=CHAR},
            </if>
            <if test="scriptPubKey != null and scriptPubKey != '' ">
                script_pub_key = #{scriptPubKey,jdbcType=LONGVARCHAR},
            </if>
        </set>
        where txid = #{txid,jdbcType=CHAR}
        and vout = #{vout,jdbcType=INTEGER}
    </update>


</mapper>